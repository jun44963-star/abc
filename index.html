<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë¸”ë¡œê·¸/ì¹´í˜ ê¸€ ë‚´ìš© ì¶”ì¶œê¸°</title>
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0"
  />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      margin: 0;
      padding: 16px;
    }
    .container {
      max-width: 960px;
      margin: 0 auto;
    }
    h1 {
      font-size: 1.4rem;
      margin-bottom: 0.5rem;
    }
    small {
      color: #9ca3af;
    }
    .card {
      background: #020617;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 10px 40px rgba(15, 23, 42, 0.7);
      border: 1px solid #1f2937;
      margin-top: 12px;
    }
    label {
      display: block;
      font-size: 0.9rem;
      margin-bottom: 4px;
      color: #e5e7eb;
    }
    input,
    textarea {
      width: 100%;
      border-radius: 8px;
      border: 1px solid #374151;
      padding: 8px 10px;
      font-size: 0.9rem;
      box-sizing: border-box;
      background: #020617;
      color: #e5e7eb;
    }
    textarea {
      min-height: 140px;
      resize: vertical;
    }
    input:focus,
    textarea:focus {
      outline: none;
      border-color: #6366f1;
      box-shadow: 0 0 0 1px #6366f1;
    }
    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
      align-items: center;
    }
    .row > * {
      flex: 1;
      min-width: 0;
    }
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 8px 14px;
      border-radius: 999px;
      font-size: 0.9rem;
      border: none;
      cursor: pointer;
      white-space: nowrap;
      user-select: none;
    }
    .btn-primary {
      background: #6366f1;
      color: #f9fafb;
    }
    .btn-outline {
      background: transparent;
      color: #e5e7eb;
      border: 1px solid #4b5563;
    }
    .btn:disabled {
      opacity: 0.6;
      cursor: default;
    }
    .status {
      margin-top: 8px;
      font-size: 0.8rem;
      color: #9ca3af;
      white-space: pre-line;
    }
    .status.error {
      color: #fca5a5;
    }
    .status.success {
      color: #6ee7b7;
    }
    .result-box {
      margin-top: 12px;
    }
    .result-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 6px;
      font-size: 0.85rem;
      color: #9ca3af;
    }
    .result-content {
      background: #020617;
      border-radius: 8px;
      border: 1px solid #1f2937;
      padding: 10px;
      min-height: 120px;
      white-space: pre-wrap;
      word-break: break-all;
      font-size: 0.9rem;
    }
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid #374151;
      background: rgba(15, 23, 42, 0.9);
      font-size: 0.75rem;
      color: #9ca3af;
    }
    code {
      background: #030712;
      border-radius: 4px;
      padding: 1px 4px;
      font-size: 0.75rem;
      border: 1px solid #111827;
    }
    @media (max-width: 640px) {
      .row {
        flex-direction: column;
        align-items: stretch;
      }
      .btn {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ë¸”ë¡œê·¸ / ì¹´í˜ ê¸€ ë‚´ìš© ì¶”ì¶œê¸°</h1>
    <small
      >ë„¤ì´ë²„ ë¸”ë¡œê·¸, ë„¤ì´ë²„ ì¹´í˜(ArticleRead í¬í•¨) ë“±ì—ì„œ <b>ë³¸ë¬¸ë§Œ</b>
      ë½‘ì•„ì˜¤ê¸°</small
    >

    <!-- URL ì…ë ¥ -->
    <div class="card">
      <label for="urlInput">â‘  URL ë„£ê³  ë³¸ë¬¸ ì¶”ì¶œ</label>
      <input
        id="urlInput"
        type="text"
        placeholder="https://blog.naver.com/..., https://cafe.naver.com/..."
      />

      <div class="row">
        <button id="btnExtractUrl" class="btn btn-primary">
          URLë¡œ ì¶”ì¶œ (Worker ì‚¬ìš©)
        </button>
        <button id="btnClear" class="btn btn-outline">ì´ˆê¸°í™”</button>
      </div>

      <div id="statusUrl" class="status"></div>
    </div>

    <!-- HTML ë¶™ì—¬ë„£ê¸° -->
    <div class="card">
      <label for="htmlInput">
        â‘¡ HTML ì „ì²´ë¥¼ ê·¸ëŒ€ë¡œ ë¶™ì—¬ë„£ì–´ ì¶”ì¶œ (ë„¤ì´ë²„ 'ì›ë³¸ë³´ê¸°' / ì¹´í˜ ArticleRead
        HTML ë“±)
      </label>
      <textarea
        id="htmlInput"
        placeholder="í˜ì´ì§€ HTML ì†ŒìŠ¤ë¥¼ í†µì§¸ë¡œ ë¶™ì—¬ë„£ê³  ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”."
      ></textarea>

      <div class="row">
        <button id="btnExtractHtml" class="btn btn-outline">
          HTMLì—ì„œ ë³¸ë¬¸ ì¶”ì¶œ
        </button>
      </div>

      <div id="statusHtml" class="status"></div>
    </div>

    <!-- ê²°ê³¼ -->
    <div class="card result-box">
      <div class="result-header">
        <span>ì¶”ì¶œ ê²°ê³¼</span>
        <div>
          <button id="btnCopy" class="btn btn-outline" style="font-size: 0.8rem">
            ë³µì‚¬í•˜ê¸°
          </button>
        </div>
      </div>
      <div id="resultContent" class="result-content"></div>
      <div style="margin-top: 6px; display: flex; gap: 4px; flex-wrap: wrap">
        <span class="pill"
          >ìƒíƒœ: <span id="pillStatus">ëŒ€ê¸° ì¤‘</span></span
        >
        <span class="pill"
          >íƒ€ì…: <span id="pillType">-</span></span
        >
        <span class="pill"
          >ë°©ë²•: <span id="pillMethod">-</span></span
        >
      </div>
    </div>
  </div>

  <script>
    // ==============================
    // 0. í™˜ê²½ ì„¤ì • (ë„¤ê°€ ë°°í¬í•œ Worker ì£¼ì†Œ)
    // ==============================
    const WORKER_URL = "https://summer-sky-c8a4.jun1317.workers.dev"; // ğŸ‘ˆ ë„¤ worker URL

    // ==============================
    // 1. URL ìœ í˜• íŒë³„
    // ==============================
    function isNaverBlog(url) {
      return /(?:blog\.naver\.com|m\.blog\.naver\.com)/i.test(url);
    }

    function isNaverCafe(url) {
      return /(?:cafe\.naver\.com)/i.test(url);
    }

    // ==============================
    // 2. (ì§€ê¸ˆ ë„¤ê°€ ê°€ì ¸ì˜¨) ì¹´í˜ ArticleRead URL ì°¾ê¸°
    // ==============================
    function findCafeArticleUrl(html) {
      if (!html) return null;

      let m, url;

      // 1) iframe id="cafe_main"
      m = html.match(
        /<iframe[^>]+id=["']cafe_main["'][^>]*src=["']([^"']+)["']/i
      );
      url = m && m[1];

      // 2) JSì—ì„œ cafe_main.src ì„¤ì •í•˜ëŠ” íŒ¨í„´
      if (!url) {
        m = html.match(
          /cafe_main["']\)\s*\.?\s*src\s*=\s*["']([^"']+)["']/i
        );
        url = m && m[1];
      }

      // 3) ArticleRead.nhn? ... ë§Œ ë¬¸ìì—´ë¡œ ìˆì„ ë•Œ
      if (!url) {
        m = html.match(/ArticleRead\.nhn\?[^"' ]+/i);
        url = m && m[0];
      }

      if (!url) return null;

      // ğŸ”¥ ê³µë°±, íƒ­, ì¤„ë°”ê¿ˆ ì „ë¶€ ì œê±° (ë„¤ê°€ ì¤€ HTMLì²˜ëŸ¼ ì¤‘ê°„ì— ê³µë°±ì´ ê»´ ìˆëŠ” ê²ƒ ëŒ€ë¹„)
      url = url.replace(/\s+/g, "");

      // ì ˆëŒ€ì£¼ì†Œë¡œ ì •ë¦¬
      if (url.startsWith("//")) {
        url = "https:" + url;
      } else if (url.startsWith("/")) {
        url = "https://cafe.naver.com" + url;
      } else if (!/^https?:\/\//i.test(url)) {
        url = "https://cafe.naver.com/" + url.replace(/^\//, "");
      }

      return url;
    }

    // ==============================
    // 3. Worker í†µí•´ HTML ê°€ì ¸ì˜¤ê¸°
    // ==============================
    async function fetchViaWorker(targetUrl) {
      const u = new URL(WORKER_URL);
      u.searchParams.set("url", targetUrl);

      const res = await fetch(u.toString(), {
        method: "GET",
      });

      if (!res.ok) {
        throw new Error("Worker ì˜¤ë¥˜ (" + res.status + ")");
      }

      const text = await res.text();
      return text;
    }

    // ==============================
    // 4. HTML ë¬¸ìì—´ â†’ Document
    // ==============================
    function parseHtml(html) {
      return new DOMParser().parseFromString(html, "text/html");
    }

    // ==============================
    // 5. ë„¤ì´ë²„ ë¸”ë¡œê·¸ ë³¸ë¬¸ ì¶”ì¶œ
    // ==============================
    function extractFromNaverBlog(doc) {
      // ì—ë””í„° v2
      let el =
        doc.querySelector(".se-main-container") ||
        doc.querySelector("div.se_component_wrap");

      // ì˜ˆì „ ì—ë””í„°
      if (!el) {
        el =
          doc.querySelector("#postViewArea") ||
          doc.querySelector("#printPost1") ||
          doc.querySelector("#contents");
      }

      return el ? el.innerText.trim() : "";
    }

    // ==============================
    // 6. ë„¤ì´ë²„ ì¹´í˜ ë³¸ë¬¸ ì¶”ì¶œ (ArticleRead.nhn, ca-fe ...)
    // ==============================
    function extractFromNaverCafe(doc) {
      const candidates = [
        "#dic_area",
        "#userContents",
        "#articleBody",
        "#content-area",
        ".se-main-container",
        "div.ContentRenderer",
      ];

      for (const sel of candidates) {
        const el = doc.querySelector(sel);
        if (el && el.innerText.trim()) {
          return el.innerText.trim();
        }
      }

      // fallback: ê°€ì¥ í° í…ìŠ¤íŠ¸ ì˜ì—­ candidate
      let best = "";
      let bestLen = 0;
      const divs = doc.querySelectorAll("div");
      divs.forEach((d) => {
        const text = d.innerText.trim();
        const len = text.length;
        if (len > 300 && len > bestLen) {
          bestLen = len;
          best = text;
        }
      });
      return best;
    }

    // ==============================
    // 7. ì¼ë°˜ ì›¹í˜ì´ì§€ ë³¸ë¬¸ ì¶”ì¶œ (ê°„ë‹¨ ë²„ì „)
    // ==============================
    function extractGeneric(doc) {
      const candidates = [
        "article",
        "main",
        "#content",
        "#contents",
        ".article",
        ".post",
        ".entry-content",
      ];

      for (const sel of candidates) {
        const el = doc.querySelector(sel);
        if (el && el.innerText.trim()) {
          return el.innerText.trim();
        }
      }

      // fallback: ë³¸ë¬¸ì´ ê¸¸ì–´ ë³´ì´ëŠ” div í•˜ë‚˜
      let best = "";
      let bestLen = 0;
      const divs = doc.querySelectorAll("div");
      divs.forEach((d) => {
        const text = d.innerText.trim();
        const len = text.length;
        if (len > 300 && len > bestLen) {
          bestLen = len;
          best = text;
        }
      });
      return best;
    }

    // ==============================
    // 8. UI í—¬í¼
    // ==============================
    const $ = (id) => document.getElementById(id);

    function setStatus(targetId, msg, type) {
      const el = $(targetId);
      el.textContent = msg || "";
      el.classList.remove("error", "success");
      if (type) el.classList.add(type);
    }

    function setResult(text) {
      $("resultContent").textContent = text || "";
    }

    function setPills({ status, type, method }) {
      if (status !== undefined) $("pillStatus").textContent = status;
      if (type !== undefined) $("pillType").textContent = type;
      if (method !== undefined) $("pillMethod").textContent = method;
    }

    function setLoading(isLoading) {
      $("btnExtractUrl").disabled = isLoading;
      $("btnExtractHtml").disabled = isLoading;
      $("btnCopy").disabled = isLoading;
    }

    // ==============================
    // 9. URLë¡œ ì¶”ì¶œ (ë²„íŠ¼ â‘ )
    // ==============================
    async function handleExtractFromUrl() {
      const rawUrl = $("urlInput").value.trim();
      if (!rawUrl) {
        setStatus("statusUrl", "URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.", "error");
        return;
      }

      setLoading(true);
      setStatus("statusUrl", "Workerë¥¼ í†µí•´ í˜ì´ì§€ HTML ê°€ì ¸ì˜¤ëŠ” ì¤‘...", "");
      setStatus("statusHtml", "");
      setResult("");
      setPills({ status: "ì²˜ë¦¬ ì¤‘...", type: "-", method: "URL + Worker" });

      try {
        let targetUrl = rawUrl;
        let pageType = "ì¼ë°˜";

        // 1ë‹¨ê³„: ë„¤ì´ë²„ ì¹´í˜ ë©”ì¸ URLì´ë©´ â†’ ArticleRead.nhn URL ì°¾ì•„ì„œ ë‹¤ì‹œ ìš”ì²­
        if (isNaverCafe(targetUrl)) {
          pageType = "ë„¤ì´ë²„ ì¹´í˜";

          const cafeHtml = await fetchViaWorker(targetUrl);
          if (!cafeHtml) {
            throw new Error("ë„¤ì´ë²„ ì¹´í˜ HTMLì„ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
          }

          const articleUrl = findCafeArticleUrl(cafeHtml);

          if (!articleUrl) {
            setStatus(
              "statusUrl",
              [
                "ì´ í˜ì´ì§€ëŠ” JSë¡œë§Œ ë Œë”ë§ë˜ëŠ” êµ¬ì¡°ë¼ Worker ë‹¨ë…ìœ¼ë¡œëŠ” ë³¸ë¬¸ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",
                "",
                "ê°€ëŠ¥í•˜ë©´ 'ëª¨ë°”ì¼/í´ë˜ì‹ ë³´ê¸°' ì£¼ì†Œë‚˜ ArticleRead.nhn í˜•íƒœì˜ ì£¼ì†Œë¥¼ ì§ì ‘ ë„£ì–´ì£¼ì„¸ìš”.",
              ].join("\n"),
              "error"
            );
            setPills({
              status: "ì‹¤íŒ¨",
              type: "ë„¤ì´ë²„ ì¹´í˜(ì›¹-PC JS ë Œë”ë§)",
              method: "URL + Worker",
            });
            return;
          }

          targetUrl = articleUrl; // ì§„ì§œ ë³¸ë¬¸ í˜ì´ì§€ë¡œ êµì²´
        } else if (isNaverBlog(targetUrl)) {
          pageType = "ë„¤ì´ë²„ ë¸”ë¡œê·¸";
        }

        // 2ë‹¨ê³„: ì‹¤ì œ ë³¸ë¬¸ì´ ìˆëŠ” targetUrlë¥¼ Workerë¡œ ë°›ì•„ì˜¤ê¸°
        const html = await fetchViaWorker(targetUrl);

        if (!html) {
          throw new Error("Failed to fetch");
        }

        const doc = parseHtml(html);

        // 3ë‹¨ê³„: íƒ€ì…ë³„ë¡œ ë³¸ë¬¸ ì¶”ì¶œ
        let content = "";
        if (isNaverBlog(targetUrl)) {
          content = extractFromNaverBlog(doc);
          pageType = "ë„¤ì´ë²„ ë¸”ë¡œê·¸";
        } else if (isNaverCafe(targetUrl)) {
          content = extractFromNaverCafe(doc);
          pageType = "ë„¤ì´ë²„ ì¹´í˜(ArticleRead)";
        } else {
          content = extractGeneric(doc);
          pageType = "ì¼ë°˜ í˜ì´ì§€";
        }

        if (!content || !content.trim()) {
          setStatus(
            "statusUrl",
            [
              "ë³¸ë¬¸ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (ë¹„ê³µê°œ/ë¡œê·¸ì¸ í•„ìš”/êµ¬ì¡° íŠ¹ì´ ê°€ëŠ¥)",
              "",
              "â€¢ ì¹´í˜ë¼ë©´ 'ëª¨ë°”ì¼ ë³´ê¸°'ë‚˜ ArticleRead.nhn ì£¼ì†Œë¥¼ ì§ì ‘ ë³µì‚¬í•´ì„œ ë„£ì–´ë³´ì„¸ìš”.",
              "â€¢ ë˜ëŠ” ìœ„ì—ì„œ í˜ì´ì§€ HTMLì„ í†µì§¸ë¡œ ë¶™ì—¬ë„£ëŠ” ë°©ë²•(â‘¡)ë„ ì´ìš©í•´ë³´ì„¸ìš”.",
            ].join("\n"),
            "error"
          );
          setPills({ status: "ì‹¤íŒ¨", type: pageType, method: "URL + Worker" });
          return;
        }

        setResult(content);
        setStatus("statusUrl", "ì¶”ì¶œ ì™„ë£Œ!", "success");
        setPills({ status: "ì™„ë£Œ", type: pageType, method: "URL + Worker" });
      } catch (e) {
        console.error(e);
        setStatus(
          "statusUrl",
          "ë„¤íŠ¸ì›Œí¬ ë¬¸ì œë¡œ ì—°ê²°ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì ì‹œ í›„ì— ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.\n\nì˜¤ë¥˜ ìƒì„¸: " +
            (e.message || e),
          "error"
        );
        setPills({ status: "ì‹¤íŒ¨", type: "-", method: "URL + Worker" });
      } finally {
        setLoading(false);
      }
    }

    // ==============================
    // 10. HTML ë¶™ì—¬ë„£ê¸°ì—ì„œ ì¶”ì¶œ (ë²„íŠ¼ â‘¡)
    // ==============================
    function handleExtractFromHtml() {
      const html = $("htmlInput").value;
      if (!html.trim()) {
        setStatus("statusHtml", "HTMLì„ ë¶™ì—¬ë„£ì–´ ì£¼ì„¸ìš”.", "error");
        return;
      }

      setLoading(true);
      setStatus("statusHtml", "ë¡œì»¬ì—ì„œ HTML íŒŒì‹± ì¤‘...", "");
      setStatus("statusUrl", "");
      setResult("");
      setPills({ status: "ì²˜ë¦¬ ì¤‘...", type: "-", method: "HTML ë¶™ì—¬ë„£ê¸°" });

      try {
        const doc = parseHtml(html);

        let pageType = "-";
        let content = "";

        // ë„¤ì´ë²„ ë¸”ë¡œê·¸/ì¹´í˜ ì—¬ë¶€ ì¶”ì¸¡ (meta / og:url ë“±ì— blog/cafe í¬í•¨)
        const htmlLower = html.toLowerCase();
        if (htmlLower.includes("blog.naver.com") || htmlLower.includes("m.blog.naver.com")) {
          pageType = "ë„¤ì´ë²„ ë¸”ë¡œê·¸";
          content = extractFromNaverBlog(doc);
        } else if (
          htmlLower.includes("cafe.naver.com") ||
          htmlLower.includes("articleread.nhn")
        ) {
          pageType = "ë„¤ì´ë²„ ì¹´í˜(ArticleRead ì¶”ì •)";
          content = extractFromNaverCafe(doc);
        } else {
          pageType = "ì¼ë°˜ í˜ì´ì§€";
          content = extractGeneric(doc);
        }

        if (!content || !content.trim()) {
          setStatus(
            "statusHtml",
            "ë³¸ë¬¸ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (HTML êµ¬ì¡° íŠ¹ì´ ê°€ëŠ¥)",
            "error"
          );
          setPills({
            status: "ì‹¤íŒ¨",
            type: pageType,
            method: "HTML ë¶™ì—¬ë„£ê¸°",
          });
          return;
        }

        setResult(content);
        setStatus("statusHtml", "ì¶”ì¶œ ì™„ë£Œ!", "success");
        setPills({
          status: "ì™„ë£Œ",
          type: pageType,
          method: "HTML ë¶™ì—¬ë„£ê¸°",
        });
      } catch (e) {
        console.error(e);
        setStatus(
          "statusHtml",
          "ì˜¤ë¥˜ ë°œìƒ: " + (e.message || e),
          "error"
        );
        setPills({
          status: "ì‹¤íŒ¨",
          type: "-",
          method: "HTML ë¶™ì—¬ë„£ê¸°",
        });
      } finally {
        setLoading(false);
      }
    }

    // ==============================
    // 11. ë³µì‚¬í•˜ê¸°
    // ==============================
    async function handleCopy() {
      const text = $("resultContent").textContent || "";
      if (!text.trim()) return;

      try {
        await navigator.clipboard.writeText(text);
        setStatus("statusUrl", "ë³µì‚¬ ì™„ë£Œ!", "success");
      } catch (e) {
        alert("ë³µì‚¬ ì‹¤íŒ¨: " + (e.message || e));
      }
    }

    // ==============================
    // 12. ì´ˆê¸°í™”
    // ==============================
    function handleClear() {
      $("urlInput").value = "";
      $("htmlInput").value = "";
      setStatus("statusUrl", "");
      setStatus("statusHtml", "");
      setResult("");
      setPills({ status: "ëŒ€ê¸° ì¤‘", type: "-", method: "-" });
    }

    // ==============================
    // 13. ì´ë²¤íŠ¸ ë°”ì¸ë”©
    // ==============================
    $("btnExtractUrl").addEventListener("click", handleExtractFromUrl);
    $("btnExtractHtml").addEventListener("click", handleExtractFromHtml);
    $("btnCopy").addEventListener("click", handleCopy);
    $("btnClear").addEventListener("click", handleClear);
  </script>
</body>
</html>
